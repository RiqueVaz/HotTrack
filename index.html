<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotTrack SAAS</title>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#020617"/>

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100%22><text y=%22.9em%22 font-size=%2290%22>⚡️</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0;
            background-image: radial-gradient(circle at 1px 1px, rgba(56, 189, 248, 0.1) 1px, transparent 0);
            background-size: 20px 20px;
        }
        .card {
            background-color: rgba(15, 23, 42, 0.6); border: 1px solid rgba(56, 189, 248, 0.2);
            backdrop-filter: blur(12px); transition: all 0.3s ease;
        }
        .form-input, .form-select, .form-date {
            background-color: rgba(30, 41, 59, 0.5); border: 1px solid #334155; color: #cbd5e1;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus, .form-date:focus {
            outline: none; border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
        }
        .form-date::-webkit-calendar-picker-indicator {
            filter: invert(0.6) sepia(1) saturate(5) hue-rotate(180deg);
        }
        .btn {
            background-color: #0ea5e9; color: white; transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(14, 165, 233, 0.3), inset 0 0 5px rgba(255, 255, 255, 0.1);
            border: 1px solid #38bdf8;
        }
        .btn:hover {
            background-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.6);
            transform: translateY(-2px);
        }
        .btn:disabled { background-color: #334155; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-red { background-color: #7f1d1d; border-color: #b91c1c; box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        .btn-red:hover { background-color: #991b1b; box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }
        .btn-green { background-color: #047857; border-color: #059669; box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
        .btn-green:hover { background-color: #059669; box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
        .btn-secondary { background-color: #334155; border-color: #475569; box-shadow: none; }
        .btn-secondary:hover { background-color: #475569; transform: translateY(-2px); }
        .nav-link { color: #94a3b8; border-left: 3px solid transparent; cursor: pointer; transition: all 0.3s ease; }
        .nav-link:hover { background-color: rgba(56, 189, 248, 0.05); border-left-color: #38bdf8; color: #e2e8f0; }
        .nav-link.active { background-color: rgba(14, 165, 233, 0.1); border-left-color: #0ea5e9; color: white; font-weight: 600; }
        .modal { display: none; }
        .modal.active { display: flex; align-items: center; justify-content: center; position: fixed; z-index: 50; inset: 0; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(8px); }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-indicator { font-size: 0.75rem; font-weight: 500; padding: 0.125rem 0.5rem; border-radius: 9999px; display: inline-block; margin-left: 0.75rem; vertical-align: middle; }
        .status-indicator.success { background-color: rgba(74, 222, 128, 0.1); color: #4ade80; border: 1px solid rgba(74, 222, 128, 0.2); }
        .status-indicator.failure { background-color: rgba(248, 113, 113, 0.1); color: #f87171; border: 1px solid rgba(248, 113, 113, 0.2); }
        .status-indicator.unknown { background-color: rgba(100, 116, 139, 0.1); color: #94a3b8; border: 1px solid rgba(100, 116, 139, 0.2); }
        .status-indicator.testing { background-color: rgba(56, 189, 248, 0.1); color: #7dd3fc; border: 1px solid rgba(56, 189, 248, 0.2); }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="modal-container"></div>

    <script>
    const App = {
        state: {
            API_BASE_URL: 'https://novaapi-one.vercel.app',
            token: null,
            data: { pixels: [], bots: [], pressels: [], settings: {}, transactions: [] },
            currentPage: 'dashboard',
        },

        async init() {
            if (window.location.origin.includes('localhost') || window.location.origin.includes('127.0.0.1')) {
                this.state.API_BASE_URL = 'http://localhost:3000';
            }
            this.state.token = localStorage.getItem('hottrack_token');
            const appContainer = document.getElementById('app');
            appContainer.innerHTML = `<div class="flex h-screen items-center justify-center"><p>Carregando...</p></div>`;
            if (this.state.token) {
                try {
                    this.state.data = await this.apiRequest('/api/dashboard/data');
                    this.renderLayout();
                } catch (e) { this.logout(); }
            } else {
                this.renderLogin();
            }
        },

        renderLogin(page = 'login') {
            document.getElementById('app').innerHTML = this.templates.auth(page);
            this.addAuthEventListeners();
        },

        renderLayout() {
            document.getElementById('app').innerHTML = this.templates.layout();
            this.navigateTo(this.state.currentPage || 'dashboard');
            this.addDashboardEventListeners();
        },
        
        templates: {
            auth(page = 'login') { /* Código inalterado */ return `<div class="flex items-center justify-center min-h-screen p-4"><div id="auth-forms-container" class="w-full max-w-md">${page === 'login' ? this.loginForm() : this.registerForm()}</div></div>`; },
            loginForm() { /* Código inalterado */ return `<div class="card p-8 rounded-2xl shadow-lg animate-fade-in"><h1 class="text-3xl font-bold text-center text-white">Acessar Plataforma</h1><form id="loginForm" class="space-y-6 mt-8"><div><label class="text-sm font-medium text-gray-400">E-mail</label><input name="email" type="email" required class="form-input w-full p-3 mt-1 rounded-md"></div><div><label class="text-sm font-medium text-gray-400">Senha</label><input name="password" type="password" required class="form-input w-full p-3 mt-1 rounded-md"></div><button type="submit" class="btn w-full font-semibold py-3 rounded-md">Entrar</button></form><div class="text-center mt-6"><a href="#" id="showRegister" class="text-sm text-sky-400 hover:text-sky-300">Não tem uma conta? Cadastre-se</a></div></div>`; },
            registerForm() { /* Código inalterado */ return `<div class="card p-8 rounded-2xl shadow-lg animate-fade-in"><h1 class="text-3xl font-bold text-center text-white">Criar Conta</h1><form id="registerForm" class="space-y-6 mt-8"><div><label class="text-sm font-medium text-gray-400">Nome</label><input name="name" type="text" required class="form-input w-full p-3 mt-1 rounded-md"></div><div><label class="text-sm font-medium text-gray-400">E-mail</label><input name="email" type="email" required class="form-input w-full p-3 mt-1 rounded-md"></div><div><label class="text-sm font-medium text-gray-400">Senha</label><input name="password" type="password" required minlength="8" class="form-input w-full p-3 mt-1 rounded-md"></div><button type="submit" class="btn w-full font-semibold py-3 rounded-md">Criar Conta</button></form><div class="text-center mt-6"><a href="#" id="showLogin" class="text-sm text-sky-400 hover:text-sky-300">Já tem uma conta? Faça Login</a></div></div>`; },
            layout() { /* Código inalterado */ return `<div class="flex h-screen"><aside class="w-64 card p-4 flex flex-col"><div class="text-center mb-10 flex items-center justify-center gap-2"><svg class="h-8 w-8 text-sky-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg><h1 class="text-2xl font-bold text-white">HotTrack</h1></div><nav id="sidebarNav" class="flex flex-col space-y-2"><div data-target="dashboard" class="nav-link p-3 rounded-lg flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10v11h18V10M3 10l9-7 9 7M3 10h18" /></svg>Dashboard</div><div data-target="settings" class="nav-link p-3 rounded-lg flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>API PIX</div></nav><div class="mt-auto"><button id="logoutButton" class="w-full text-gray-400 hover:bg-red-900/50 hover:text-white font-semibold py-2 px-4 rounded-md flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>Sair</button></div></aside><main id="content" class="flex-1 p-8 overflow-y-auto"></main></div>`; },
            
            // =========================================================================
            // TEMPLATE SETTINGS MODIFICADO COM TESTES INDIVIDUAIS
            // =========================================================================
            settings() {
                const { settings } = App.state.data;
                const providers = [
                    { value: 'pushinpay', text: 'PushinPay' },
                    { value: 'cnpay', text: 'CN Pay' },
                    { value: 'oasyfy', text: 'Oasy.fy' }
                ];
                const createSelect = (name, selectedValue) => {
                    const options = providers.map(p => `<option value="${p.value}" ${p.value === selectedValue ? 'selected' : ''}>${p.text}</option>`).join('');
                    return `<select name="${name}" class="form-select w-full p-2 rounded-md">${options}<option value="" ${!selectedValue ? 'selected' : ''}>Nenhum</option></select>`;
                };
                return `
                <div class="animate-fade-in">
                    <h1 class="text-3xl font-bold text-white mb-6">API PIX</h1>
                    <form id="pixSettingsForm" class="space-y-8 max-w-3xl">
                        <div class="card p-6 rounded-lg">
                            <h2 class="text-xl font-semibold mb-2 text-white">Ordem de Prioridade dos Provedores</h2>
                            <p class="text-sm text-gray-400 mb-4">Defina a ordem em que o sistema tentará gerar o PIX. Se o Provedor Primário falhar, o sistema automaticamente tentará o Secundário.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-400">1º - Provedor Primário</label>
                                    ${createSelect('pix_provider_primary', settings.pix_provider_primary)}
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-400">2º - Provedor Secundário</label>
                                    ${createSelect('pix_provider_secondary', settings.pix_provider_secondary)}
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-400">3º - Provedor Terciário</label>
                                    ${createSelect('pix_provider_tertiary', settings.pix_provider_tertiary)}
                                </div>
                            </div>
                        </div>
                        <div class="card p-6 rounded-lg">
                            <h2 class="text-xl font-semibold text-white mb-4">Credenciais e Teste Individual</h2>
                             <p class="text-sm text-gray-400 mb-6">Insira as credenciais e use o botão de teste de cada provedor para verificar a conexão individualmente.</p>
                            <div class="space-y-6">
                                <div class="p-4 border border-slate-700 rounded-lg">
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-lg font-medium text-sky-400 inline-block">PushinPay<span id="status-indicator-pushinpay"></span></h3>
                                        <button type="button" data-provider="pushinpay" class="test-provider-btn btn btn-secondary text-sm py-2 px-3">Testar PushinPay</button>
                                    </div>
                                    <label class="block mb-2 text-sm text-gray-400">Bearer Token</label>
                                    <input name="pushinpay_token" type="password" value="${settings.pushinpay_token || ''}" class="form-input w-full p-2 rounded-md">
                                </div>
                                <div class="p-4 border border-slate-700 rounded-lg">
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-lg font-medium text-sky-400 inline-block">CN Pay<span id="status-indicator-cnpay"></span></h3>
                                        <button type="button" data-provider="cnpay" class="test-provider-btn btn btn-secondary text-sm py-2 px-3">Testar CN Pay</button>
                                    </div>
                                    <label class="block mb-2 text-sm text-gray-400">Chave Pública (public-key)</label>
                                    <input name="cnpay_public_key" type="password" value="${settings.cnpay_public_key || ''}" class="form-input w-full p-2 rounded-md">
                                    <label class="block mt-4 mb-2 text-sm text-gray-400">Chave Privada (secret-key)</label>
                                    <input name="cnpay_secret_key" type="password" value="${settings.cnpay_secret_key || ''}" class="form-input w-full p-2 rounded-md">
                                </div>
                                <div class="p-4 border border-slate-700 rounded-lg">
                                     <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-lg font-medium text-sky-400 inline-block">Oasy.fy<span id="status-indicator-oasyfy"></span></h3>
                                        <button type="button" data-provider="oasyfy" class="test-provider-btn btn btn-secondary text-sm py-2 px-3">Testar Oasy.fy</button>
                                    </div>
                                    <label class="block mb-2 text-sm text-gray-400">Chave Pública (public-key)</label>
                                    <input name="oasyfy_public_key" type="password" value="${settings.oasyfy_public_key || ''}" class="form-input w-full p-2 rounded-md">
                                    <label class="block mt-4 mb-2 text-sm text-gray-400">Chave Privada (secret-key)</label>
                                    <input name="oasyfy_secret_key" type="password" value="${settings.oasyfy_secret_key || ''}" class="form-input w-full p-2 rounded-md">
                                </div>
                            </div>
                        </div>
                        <div><button type="submit" class="btn w-full p-3 font-bold rounded-md">Salvar Configurações</button></div>
                    </form>
                </div>`;
            },
            modal(title, content) {
                return `<div id="modal" class="modal active"><div class="card p-6 rounded-lg w-full max-w-lg animate-fade-in"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-white">${title}</h2><button id="closeModalBtn" class="text-gray-400 hover:text-white text-2xl">&times;</button></div>${content}</div></div>`;
            }
        },

        addAuthEventListeners() {
            const container = document.getElementById('app');
            container.addEventListener('click', (e) => {
                if (e.target.id === 'showRegister') { e.preventDefault(); this.renderLogin('register'); }
                if (e.target.id === 'showLogin') { e.preventDefault(); this.renderLogin('login'); }
            });
            container.addEventListener('submit', async (e) => {
                e.preventDefault();
                const form = e.target;
                const data = Object.fromEntries(new FormData(form).entries());
                if (form.id === 'loginForm') await this.login(data.email, data.password);
                if (form.id === 'registerForm') await this.register(data.name, data.email, data.password);
            });
        },
        
        addDashboardEventListeners() {
            document.addEventListener('click', async (e) => {
                if (e.target.id === 'logoutButton') this.logout();
                if (e.target.id === 'closeModalBtn') document.getElementById('modal-container').innerHTML = '';
                
                const sidebarLink = e.target.closest('.nav-link');
                if (sidebarLink) this.navigateTo(sidebarLink.dataset.target);

                // **NOVO LISTENER PARA OS BOTÕES DE TESTE INDIVIDUAIS**
                const testBtn = e.target.closest('.test-provider-btn');
                if (testBtn) {
                    const provider = testBtn.dataset.provider;
                    this.testPixConnection(provider, testBtn);
                }

                const copyBtn = e.target.closest('.copy-btn');
                if (copyBtn) {
                    const target = document.querySelector(copyBtn.dataset.target);
                    if (target) {
                        navigator.clipboard.writeText(target.value).then(() => {
                            copyBtn.textContent = 'Copiado!';
                            setTimeout(() => { copyBtn.textContent = 'Copiar'; }, 2000);
                        });
                    }
                }
            });

            document.addEventListener('submit', async (e) => {
                const form = e.target.closest('form');
                if (!form || form.id !== 'pixSettingsForm') return;
                
                e.preventDefault();
                const button = form.querySelector('button[type="submit"]');
                const originalButtonText = button.innerHTML;
                button.innerHTML = 'Salvando...';
                button.disabled = true;

                try {
                    const data = Object.fromEntries(new FormData(form).entries());
                    await this.apiRequest('/api/settings/pix', 'POST', data);
                    App.state.data.settings = { ...App.state.data.settings, ...data };
                    this.showToast('Configurações PIX salvas!', 'success');
                } catch(e) { 
                    this.showToast('Erro ao salvar configurações.', 'error');
                } finally {
                    if(button) {
                        button.innerHTML = originalButtonText;
                        button.disabled = false;
                    }
                }
            });
        },

        async apiRequest(endpoint, method = 'GET', body = null) {
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (this.state.token) { headers['Authorization'] = `Bearer ${this.state.token}`; }
                const options = { method, headers };
                if (body) { options.body = JSON.stringify(body); }
                const response = await fetch(`${this.state.API_BASE_URL}${endpoint}`, options);
                
                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Erro na resposta da API');
                return data;
            } catch (error) {
                // Se o erro for de parsing (ex: a API retornou HTML), a mensagem será mais genérica
                const errorMessage = (error instanceof SyntaxError) ? "Resposta inválida do servidor." : error.message;
                this.showToast(errorMessage, 'error');
                if (error.message.includes('inválido') || error.message.includes('expirado')) this.logout();
                throw new Error(errorMessage);
            }
        },
        
        async login(email, password) { /* Código inalterado */ try { const data = await this.apiRequest('/api/sellers/login', 'POST', { email, password }); this.state.token = data.token; localStorage.setItem('hottrack_token', data.token); await this.init(); } catch (e) {} },
        async register(name, email, password) { /* Código inalterado */ try { await this.apiRequest('/api/sellers/register', 'POST', { name, email, password }); this.showToast('Cadastro realizado! Faça o login.', 'success'); this.renderLogin('login'); } catch (e) {} },
        logout() { /* Código inalterado */ this.state.token = null; localStorage.removeItem('hottrack_token'); this.init(); },

        navigateTo(page) {
            this.state.currentPage = page;
            const contentContainer = document.getElementById('content');
            if (contentContainer && this.templates[page]) {
                contentContainer.innerHTML = this.templates[page]();
                if (page === 'settings') {
                    this.updateAllPixStatusIndicators();
                }
                document.querySelectorAll('.nav-link').forEach(item => { item.classList.toggle('active', item.dataset.target === page); });
            }
        },
        
        // =========================================================================
        // FUNÇÃO DE TESTE MODIFICADA PARA EXIBIR LOG DE SUCESSO E FALHA
        // =========================================================================
        async testPixConnection(provider, button) {
            const originalText = button.innerHTML;
            button.innerHTML = 'Testando...';
            button.disabled = true;
            this.updatePixStatusIndicator(provider, 'testing');

            // Pega todas as credenciais do formulário para enviar ao backend
            const form = document.getElementById('pixSettingsForm');
            const credentials = Object.fromEntries(new FormData(form).entries());

            try {
                // ** IMPORTANTE: A sua API precisa de um endpoint que teste um provedor específico **
                // Este endpoint deve receber o nome do provedor e as credenciais
                const result = await this.apiRequest('/api/pix/test-provider', 'POST', {
                    provider: provider,
                    credentials: credentials
                });

                // Limpa status antigos e salva o novo status de sucesso
                localStorage.setItem(`pix_status_${provider}`, 'success');
                localStorage.setItem(`pix_timestamp_${provider}`, Date.now());
                
                // CRIA O MODAL DE SUCESSO COM O LOG (PIX COPIA E COLA)
                const pixValue = result.pixCopyPaste || result.emv || 'Nenhum código PIX retornado.'; // Adapte para o nome do campo correto
                const modalContent = `
                    <div class="text-left space-y-4">
                        <p class="text-lg font-medium text-green-400">Conexão com ${provider.toUpperCase()} bem-sucedida!</p>
                        <div>
                            <label class="text-sm text-gray-400">Log de Sucesso (PIX Copia e Cola Gerado):</label>
                            <textarea id="pix-copy-paste-result" readonly class="form-input w-full p-2 mt-1 rounded-md text-xs h-28">${pixValue}</textarea>
                        </div>
                        <div class="text-right">
                            <button class="copy-btn btn btn-secondary text-sm" data-target="#pix-copy-paste-result">Copiar</button>
                        </div>
                    </div>
                `;
                document.getElementById('modal-container').innerHTML = this.templates.modal('Teste de Conexão bem-sucedido', modalContent);

            } catch (error) {
                // Salva o status de falha
                localStorage.setItem(`pix_status_${provider}`, 'failure');
                localStorage.setItem(`pix_timestamp_${provider}`, Date.now());

                // CRIA O MODAL DE FALHA COM O LOG DE ERRO
                const modalContent = `
                    <div class="text-left space-y-2">
                        <p class="text-lg font-medium text-red-400">Falha na Conexão com ${provider.toUpperCase()}</p>
                        <p class="text-sm text-gray-400">A API retornou o seguinte erro:</p>
                        <pre class="bg-slate-900 p-3 rounded-md text-red-400 text-xs overflow-x-auto">${error.message || 'Ocorreu um erro desconhecido.'}</pre>
                    </div>`;
                document.getElementById('modal-container').innerHTML = this.templates.modal('Erro no Teste de Conexão', modalContent);
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
                this.updatePixStatusIndicator(provider);
            }
        },
        
        updateAllPixStatusIndicators() {
            ['pushinpay', 'cnpay', 'oasyfy'].forEach(provider => this.updatePixStatusIndicator(provider));
        },

        updatePixStatusIndicator(provider, mode) {
            const indicator = document.getElementById(`status-indicator-${provider}`);
            if (!indicator) return;

            if (mode === 'testing') {
                indicator.textContent = 'Testando...';
                indicator.className = 'status-indicator testing';
                return;
            }

            const status = localStorage.getItem(`pix_status_${provider}`);
            const timestamp = localStorage.getItem(`pix_timestamp_${provider}`);

            if (status === 'success' && timestamp) {
                indicator.textContent = `Ativo (Testado ${this.formatTimeAgo(timestamp)})`;
                indicator.className = 'status-indicator success';
            } else if (status === 'failure' && timestamp) {
                indicator.textContent = `Falhou (Testado ${this.formatTimeAgo(timestamp)})`;
                indicator.className = 'status-indicator failure';
            } else {
                indicator.textContent = ''; // Fica limpo se não testado
                indicator.className = '';
            }
        },

        formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return "agora";
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `há ${minutes} min`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `há ${hours}h`;
            const days = Math.floor(hours / 24);
            return `há ${days}d`;
        },
        
        showToast(message, type = 'success') {
            const toast = document.createElement('div');
            let bgColor = '';
            switch(type) {
                case 'success': bgColor = 'bg-green-600'; break;
                case 'error': bgColor = 'bg-red-600'; break;
                case 'info': bgColor = 'bg-sky-600'; break;
                default: bgColor = 'bg-gray-700';
            }
            toast.className = `fixed bottom-5 right-5 ${bgColor} text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in z-50`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }
    };

    App.init();
    </script>
</body>
</html>
